<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dettagli Opera d'Arte</title>
    <style>
        :root {
            --gold: #d4af37;
            --dark-blue: #1a252f;
            --bg-color: #f8f9fa;
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .art-card {
            background: white;
            width: 100%;
            max-width: 450px;
            border: 12px solid var(--dark-blue);
            border-image: linear-gradient(45deg, #a88e5a, #f7e0a1, #a88e5a) 1;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .image-container {
            width: 100%;
            background-color: #eee;
            border-bottom: 2px solid #ddd;
            line-height: 0;
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        .content {
            padding: 25px;
            text-align: center;
        }

        h1 {
            color: var(--dark-blue);
            font-size: 1.6rem;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .artist-name {
            font-style: italic;
            color: #666;
            margin-bottom: 20px;
            display: block;
        }

        .description {
            color: #333;
            line-height: 1.7;
            text-align: left;
            margin-bottom: 25px;
            font-size: 1.05rem;
            border-left: 3px solid var(--gold);
            padding-left: 15px;
        }

        .audio-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-audio {
            background-color: var(--dark-blue);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            user-select: none;
        }

        .btn-audio:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .btn-audio.playing {
            background-color: #c0392b;
        }

        .status-msg {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        .icon-speaker::before { content: 'üîä'; }
        .icon-stop::before { content: '‚èπ'; }

    </style>
</head>
<body>

    <div class="art-card">
        <div class="image-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/Caspar_David_Friedrich_-_Wanderer_over_the_sea_of_fog.jpg/800px-Caspar_David_Friedrich_-_Wanderer_over_the_sea_of_fog.jpg" alt="Il Viandante sul mare di nebbia" onerror="this.src='https://via.placeholder.com/600x400?text=Immagine+Opera'">
        </div>

        <div class="content">
            <h1 id="title">Il Viandante sul mare di nebbia</h1>
            <span class="artist-name">Caspar David Friedrich, 1818</span>
            
            <div class="description" id="textToRead">
                Il Viandante sul mare di nebbia non √® solo il capolavoro di Caspar David Friedrich, ma il manifesto visivo dell‚Äôintero Romanticismo tedesco. Al centro della scena, un uomo solitario domina uno sperone roccioso, trasformato in un piedistallo naturale da cui contemplare l'immenso. Davanti a lui, le vette alpine e le nuvole si fondono in un abbraccio misterioso, incarnando quel sentimento del "Sublime" che unisce meraviglia e timore.
                Friedrich orchestra la composizione con precisione geometrica: il viandante √® il fulcro immobile di un mondo in movimento, punto d‚Äôincontro tra la terra scura e il cielo madreperlaceo. L'opera rimane soprattutto un invito all'introspezione: un dialogo silenzioso tra l'animo umano e l'insondabile mistero della natura.
            </div>

            <div class="audio-controls">
                <button id="audioBtn" class="btn-audio" onclick="handleAudio()">
                    <span id="btnIcon" class="icon-speaker"></span>
                    <span id="btnText">Ascolta la descrizione</span>
                </button>
                <div id="statusLabel" class="status-msg">Tocca per avviare la guida vocale</div>
            </div>
        </div>
    </div>

    <script>
        // Gestione globale per evitare che il garbage collector interrompa l'audio
        let synth = window.speechSynthesis;
        let currentUtterance = null;
        let isSpeaking = false;

        // Pre-caricamento delle voci (necessario per alcuni browser mobile)
        if (typeof speechSynthesis !== 'undefined' && speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => {
                speechSynthesis.getVoices();
            };
        }

        function handleAudio() {
            const btn = document.getElementById('audioBtn');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            const statusLabel = document.getElementById('statusLabel');
            const text = document.getElementById('textToRead').innerText;

            if (isSpeaking || synth.speaking) {
                synth.cancel();
                resetUI();
                return;
            }

            // Pulizia preventiva di eventuali istanze residue
            synth.cancel();

            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.lang = 'it-IT';
            currentUtterance.rate = 0.95;
            currentUtterance.pitch = 1.0;

            currentUtterance.onstart = () => {
                isSpeaking = true;
                btn.classList.add('playing');
                btnText.innerText = "Interrompi lettura";
                btnIcon.className = "icon-stop";
                statusLabel.innerText = "Riproduzione in corso...";
            };

            currentUtterance.onend = () => {
                resetUI();
            };

            currentUtterance.onerror = (event) => {
                console.error("Errore Sintesi Vocale:", event);
                resetUI();
                statusLabel.innerText = "Errore: riprova o controlla il volume.";
            };

            // Avvio effettivo
            synth.speak(currentUtterance);
        }

        function resetUI() {
            const btn = document.getElementById('audioBtn');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            const statusLabel = document.getElementById('statusLabel');
            
            isSpeaking = false;
            btn.classList.remove('playing');
            btnText.innerText = "Ascolta la descrizione";
            btnIcon.className = "icon-speaker";
            statusLabel.innerText = "Tocca per avviare la guida vocale";
        }

        // Blocco audio all'uscita per evitare "voci fantasma"
        window.addEventListener('beforeunload', () => {
            synth.cancel();
        });
    </script>

</body>
</html>
